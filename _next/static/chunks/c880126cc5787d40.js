(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,44518,e=>{"use strict";var r=e.i(39321);function t(e,r,t){if(!e||null==r)return"마감일 정보 없음";let a=new Date(new Date(e));a.setDate(a.getDate()+r);let s=new Date;s.setHours(0,0,0,0);let i=new Date(a);if(i.setHours(0,0,0,0),"deadline"===t){let e=Math.ceil((i.getTime()-s.getTime())/864e5);return 0===e?"오늘 마감":e<0?"마감됨":`${e}일 남음`}if("popular"===t||"serial"===t||"paid"===t){let e=Math.ceil((i.getTime()-s.getTime())/864e5);return e<0?"마감됨":0===e?"오늘 마감":`${e}일 남음`}let o=Math.ceil((i.getTime()-s.getTime())/864e5);return o>=0?`${o}일 남음`:"마감됨"}async function a(e){try{let{count:t,error:a}=await r.supabase.from("shares").select("*",{count:"exact",head:!0}).eq("serial_id",e);if(a)return console.error("Share count 가져오기 오류:",a),0;return t||0}catch(e){return console.error("Share count 가져오기 예외:",e),0}}async function s(e){try{let{data:t,error:a}=await r.supabase.from("shares").select("serial_id").in("serial_id",e);if(a)return console.error("Share counts 가져오기 오류:",a),{};let s={};return e.forEach(e=>{s[e]=0}),t?.forEach(e=>{s[e.serial_id]=(s[e.serial_id]||0)+1}),s}catch(e){return console.error("Share counts 가져오기 예외:",e),{}}}async function i(){try{let{data:e,error:a}=await r.supabase.from("serials").select("*").order("created_at",{ascending:!1});if(a)return console.error("Serials 가져오기 오류:",a),[];let i=e.map(e=>e.id),o=await s(i);return e.map(e=>({...e,tagList:e.tag_list||[],shareCount:o[e.id]||0,deadlineDisplay:t(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("Serials 가져오기 예외:",e),[]}}async function o(e){try{if(!e)return[];let{data:a,error:i}=await r.supabase.from("serials").select("*").eq("author_id",e).order("created_at",{ascending:!1});if(i)return console.error("작가별 Serials 가져오기 오류:",i),[];let o=a.map(e=>e.id),l=await s(o);return a.map(e=>({...e,tagList:e.tag_list||[],shareCount:l[e.id]||0,deadlineDisplay:t(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("작가별 Serials 가져오기 예외:",e),[]}}async function l(e){try{let{data:s,error:i}=await r.supabase.from("serials").select("*").eq("id",e).single();if(i)return console.error("Serial 가져오기 오류:",i),null;if(!s)return null;let o=await a(s.id);return{...s,tagList:s.tag_list||[],shareCount:o,deadlineDisplay:t(s.created_at,s.deadline,s.category)}}catch(e){return console.error("Serial 가져오기 예외:",e),null}}async function n(e){try{let{data:a,error:i}=await r.supabase.from("serials").select("*").eq("category",e).order("created_at",{ascending:!1});if(i)return console.error("카테고리별 serials 가져오기 오류:",i),[];if(!a||0===a.length)return[];let o=a.map(e=>e.id).filter(e=>null!=e),l=await s(o);return a.filter(e=>null!=e&&null!=e.id).map(e=>({...e,tagList:e.tag_list||[],shareCount:l[e.id]||0,deadlineDisplay:t(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("카테고리별 serials 가져오기 예외:",e),[]}}async function c(){return n("popular")}async function u(){try{let e=new Date,a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,{data:i,error:o}=await r.supabase.from("serials").select("*").order("created_at",{ascending:!1});if(o)return console.error("오늘 마감 serials 가져오기 오류:",o),[];if(!i||0===i.length)return[];let l=i.filter(e=>{if(!e||!e.id||!e.created_at||null===e.deadline||void 0===e.deadline)return!1;let r=new Date(e.created_at),t=r.getFullYear(),s=r.getMonth(),i=r.getDate(),o=new Date(t,s,i);o.setDate(o.getDate()+e.deadline);let l=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0");return`${l}-${n}-${c}`===a}),n=l.map(e=>e.id).filter(e=>null!=e),c=await s(n);return l.filter(e=>null!=e&&null!=e.id).map(e=>({...e,tagList:e.tag_list||[],shareCount:c[e.id]||0,deadlineDisplay:t(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("오늘 마감 serials 가져오기 예외:",e),[]}}async function d(){return n("paid")}async function f(){return n("serial")}function g(e){return null==e?null:"number"==typeof e?e:parseInt(String(e),10)||null}async function h(){try{let e=await c();if(0===e.length)return{moved:0,errors:[]};let t=0,a=[];for(let s of e){let e=s.requirement;if(null!=e&&s.shareCount>=e){let{error:e}=await r.supabase.from("serials").update({category:"serial"}).eq("id",s.id);e?(console.error(`게시글 ${s.id} 이동 실패:`,e),a.push({postId:s.id,error:e})):t++}}return{moved:t,errors:a}}catch(e){return console.error("연재도전 → 연재시작코너 이동 예외:",e),{moved:0,errors:[{error:e}]}}}async function p(){try{let t=await f();if(0===t.length)return console.log("연재시작코너 게시글이 없습니다."),{moved:0,errors:[]};console.log(`연재시작코너 게시글 ${t.length}개 확인 중...`);let s=0,i=[];for(let o of t){let t=await a(o.id),{getPostsBySerialId:l}=await e.A(87697),n=await l(o.id),c=n?n.length:0;if(console.log(`Serial ${o.id}: 공유 ${t}회, 게시글 ${c}개`),t<1){console.log(`Serial ${o.id}: 공유 조건 미달 (${t} < 1)`);continue}if(c<2){console.log(`Serial ${o.id}: 게시글 조건 미달 (${c} < 2)`);continue}console.log(`Serial ${o.id}: 조건 충족! 유료연재코너로 이동 중... (공유: ${t}회, 게시글: ${c}개)`);let{error:u}=await r.supabase.from("serials").update({category:"paid"}).eq("id",o.id);u?(console.error(`게시글 ${o.id} 유료연재코너 이동 실패:`,u),i.push({postId:o.id,error:u})):(s++,console.log(`✓ 게시글 ${o.id}가 유료연재코너로 이동되었습니다. (공유: ${t}회, 게시글: ${c}개)`))}return console.log(`총 ${s}개 게시글이 유료연재코너로 이동되었습니다.`),{moved:s,errors:i}}catch(e){return console.error("연재시작코너 → 유료연재코너 이동 예외:",e),{moved:0,errors:[{error:e}]}}}async function m(e){try{if(!e||!e.trim())return[];let a=e.toLowerCase().trim(),i=a.startsWith("#"),o=i?a.substring(1):a,l=r.supabase.from("serials").select("*");if(i){let{data:e,error:r}=await l.order("created_at",{ascending:!1});if(r)return console.error("Serials 검색 오류:",r),[];let a=e?.filter(e=>(e.tag_list||[]).some(e=>e.toLowerCase().replace("#","")===o||e.toLowerCase().includes(o)))||[],i=a.map(e=>e.id),n=await s(i);return a.map(e=>({...e,tagList:e.tag_list||[],shareCount:n[e.id]||0,deadlineDisplay:t(e.created_at,e.deadline,e.category)}))}{l=l.or(`title.ilike.%${a}%,tags.ilike.%${a}%,intro.ilike.%${a}%`);let{data:e,error:r}=await l.order("created_at",{ascending:!1});if(r)return console.error("Serials 검색 오류:",r),[];let i=(e||[]).map(e=>e.id),o=await s(i);return(e||[]).map(e=>({...e,tagList:e.tag_list||[],shareCount:o[e.id]||0,deadlineDisplay:t(e.created_at,e.deadline,e.category)}))}}catch(e){return console.error("Serials 검색 예외:",e),[]}}async function y(e){try{let{data:{session:t}}=await r.supabase.auth.getSession(),{data:a,error:s}=await r.supabase.from("serials").insert([{title:e.title,deadline:e.deadline,apply:e.apply||"신청",tags:e.tags,category:e.category,intro:e.intro,requirement:e.requirement,tag_list:e.tagList||[],author_id:t?.user?.id||null}]).select().single();if(s)throw console.error("Serial 생성 오류:",s),s;return a}catch(e){throw console.error("Serial 생성 예외:",e),e}}async function S(){try{let{data:e,error:t}=await r.supabase.from("serials").select("id");if(t)return console.error("Serial IDs 가져오기 오류:",t),[];return(e||[]).map(e=>e.id)}catch(e){return console.error("Serial IDs 가져오기 예외:",e),[]}}async function _(e,t){try{let{data:a,error:s}=await r.supabase.from("shares").insert({serial_id:e,user_id:t}).select().single();if(s)return console.error("Share 추가 오류:",s),{success:!1,error:s};return{success:!0,data:a}}catch(e){return console.error("Share 추가 예외:",e),{success:!1,error:e}}}async function w(e,t){try{let{error:a}=await r.supabase.from("shares").delete().eq("serial_id",e).eq("user_id",t);if(a)return console.error("Share 제거 오류:",a),{success:!1,error:a};return{success:!0}}catch(e){return console.error("Share 제거 예외:",e),{success:!1,error:e}}}async function b(e,t){try{let{data:a,error:s}=await r.supabase.from("shares").select("id").eq("serial_id",e).eq("user_id",t).limit(1).maybeSingle();if(s)return console.error("Share 확인 오류:",s),!1;return!!a}catch(e){return console.error("Share 확인 예외:",e),!1}}async function v(e){try{let{data:a,error:i}=await r.supabase.from("shares").select(`
        serial_id,
        created_at,
        serials (*)
      `).eq("user_id",e).order("created_at",{ascending:!1});if(i)return console.error("공유한 연재 가져오기 오류:",i),[];let o=(a||[]).map(e=>e.serial_id),l=await s(o);return(a||[]).filter(e=>e.serials).map(e=>({...e.serials,tagList:e.serials.tag_list||[],shareCount:l[e.serial_id]||0,sharedAt:e.created_at,deadlineDisplay:t(e.serials.created_at,e.serials.deadline,e.serials.category)}))}catch(e){return console.error("공유한 serials 가져오기 예외:",e),[]}}async function $(e,t){try{let{data:a,error:s}=await r.supabase.from("favorites").insert({serial_id:e,user_id:t}).select().single();if(s){if("PGRST205"===s.code||"42P01"===s.code||s.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),{success:!1,error:{message:"favorites 테이블이 아직 생성되지 않았습니다."}};return console.error("관심있는 글 추가 오류:",s),{success:!1,error:s}}return{success:!0,data:a}}catch(e){return console.error("관심있는 글 추가 예외:",e),{success:!1,error:e}}}async function D(e,t){try{let{error:a}=await r.supabase.from("favorites").delete().eq("serial_id",e).eq("user_id",t);if(a){if("PGRST205"===a.code||"42P01"===a.code||a.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),{success:!1,error:{message:"favorites 테이블이 아직 생성되지 않았습니다."}};return console.error("관심있는 글 제거 오류:",a),{success:!1,error:a}}return{success:!0}}catch(e){return console.error("관심있는 글 제거 예외:",e),{success:!1,error:e}}}async function q(e){try{let{data:a,error:i}=await r.supabase.from("favorites").select(`
        serial_id,
        created_at,
        serials (*)
      `).eq("user_id",e).order("created_at",{ascending:!1});if(i){if("PGRST205"===i.code||"42P01"===i.code||i.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),[];return console.error("관심있는 연재 가져오기 오류:",i),[]}let o=(a||[]).map(e=>e.serial_id),l=await s(o);return(a||[]).filter(e=>e.serials).map(e=>({...e.serials,tagList:e.serials.tag_list||[],shareCount:l[e.serial_id]||0,favoritedAt:e.created_at,deadlineDisplay:t(e.serials.created_at,e.serials.deadline,e.serials.category)}))}catch(e){return console.error("관심있는 글 가져오기 예외:",e),[]}}async function C(e,t){try{let{data:a,error:s}=await r.supabase.from("favorites").select("id").eq("serial_id",e).eq("user_id",t).limit(1).maybeSingle();if(s){if("PGRST205"===s.code||"42P01"===s.code||s.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),!1;return console.error("관심있는 글 확인 오류:",s),!1}return!!a}catch(e){return console.error("관심있는 글 확인 예외:",e),!1}}async function T(e,t){try{let{data:t,error:a}=await r.supabase.from("serials").select("id, category").eq("id",e).single();if(a||!t)return console.error("Serial 찾기 오류:",a),{success:!1,error:a||Error("Serial을 찾을 수 없습니다.")};let{data:s,error:i}=await r.supabase.from("serials").update({category:"popular"}).eq("id",e).select().single();if(i)return console.error("연재도전 연재 오류:",i),{success:!1,error:i};return{success:!0,data:s}}catch(e){return console.error("연재도전 연재 예외:",e),{success:!1,error:e}}}async function P(t,a){try{if(!t)return{success:!1,error:Error("잘못된 요청입니다.")};let{isAdminEmail:s}=await e.A(87697);if(!s(a))return{success:!1,error:Error("관리자만 연재를 삭제할 수 있습니다.")};let{getPostsBySerialId:i}=await e.A(87697),o=await i(t);if(o&&o.length>0){let{error:e}=await r.supabase.from("posts").delete().eq("serial_id",t);e&&console.error("연재 글 삭제 오류:",e)}let{error:l}=await r.supabase.from("serials").delete().eq("id",t);if(l)return console.error("연재 삭제 오류:",l),{success:!1,error:l};return{success:!0}}catch(e){return console.error("연재 삭제 예외:",e),{success:!1,error:e}}}e.s(["addFavorite",()=>$,"addShare",()=>_,"createSerial",()=>y,"deleteSerial",()=>P,"formatDeadline",()=>t,"getAllSerialIds",()=>S,"getAllSerials",()=>i,"getPaidSeriesSerials",()=>d,"getPopularSerials",()=>c,"getSerialById",()=>l,"getSerialPosts",()=>f,"getSerialsByAuthor",()=>o,"getSerialsByCategory",()=>n,"getShareCount",()=>a,"getTodayDeadlineSerials",()=>u,"getUserFavorites",()=>q,"getUserSharedSerials",()=>v,"hasUserFavorited",()=>C,"hasUserShared",()=>b,"movePopularToSerial",()=>h,"moveSerialToPaid",()=>p,"parseRequirement",()=>g,"publishSerialToPopular",()=>T,"removeFavorite",()=>D,"removeShare",()=>w,"searchSerials",()=>m])},87697,e=>{e.v(e=>Promise.resolve().then(()=>e(52750)))}]);