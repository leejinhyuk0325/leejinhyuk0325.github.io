(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,44518,e=>{"use strict";var r=e.i(39321);async function t(){try{let{data:e,error:t}=await r.supabase.from("config").select("key, value");if(t)return console.error("Config 값 가져오기 오류:",t),{};let a={};return e&&e.forEach(e=>{a[e.key]=e.value}),a}catch(e){return console.error("Config 값 가져오기 예외:",e),{}}}function a(e,r,t){if(!e||null==r)return"마감일 정보 없음";let a=new Date(new Date(e));a.setDate(a.getDate()+r);let s=new Date;s.setHours(0,0,0,0);let i=new Date(a);if(i.setHours(0,0,0,0),"deadline"===t){let e=Math.ceil((i.getTime()-s.getTime())/864e5);return 0===e?"오늘 마감":e<0?"마감됨":`${e}일 남음`}if("popular"===t||"serial"===t||"paid"===t){let e=Math.ceil((i.getTime()-s.getTime())/864e5);return e<0?"마감됨":0===e?"오늘 마감":`${e}일 남음`}let o=Math.ceil((i.getTime()-s.getTime())/864e5);return o>=0?`${o}일 남음`:"마감됨"}async function s(e){try{let{count:t,error:a}=await r.supabase.from("shares").select("*",{count:"exact",head:!0}).eq("serial_id",e);if(a)return console.error("Share count 가져오기 오류:",a),0;return t||0}catch(e){return console.error("Share count 가져오기 예외:",e),0}}async function i(e){try{let{data:t,error:a}=await r.supabase.from("shares").select("serial_id").in("serial_id",e);if(a)return console.error("Share counts 가져오기 오류:",a),{};let s={};return e.forEach(e=>{s[e]=0}),t?.forEach(e=>{s[e.serial_id]=(s[e.serial_id]||0)+1}),s}catch(e){return console.error("Share counts 가져오기 예외:",e),{}}}async function o(){try{let{data:e,error:t}=await r.supabase.from("serials").select("*").order("created_at",{ascending:!1});if(t)return console.error("Serials 가져오기 오류:",t),[];let s=e.map(e=>e.id),o=await i(s);return e.map(e=>({...e,tagList:e.tag_list||[],shareCount:o[e.id]||0,deadlineDisplay:a(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("Serials 가져오기 예외:",e),[]}}async function l(e){try{if(!e)return[];let{data:t,error:s}=await r.supabase.from("serials").select("*").eq("author_id",e).order("created_at",{ascending:!1});if(s)return console.error("작가별 Serials 가져오기 오류:",s),[];let o=t.map(e=>e.id),l=await i(o);return t.map(e=>({...e,tagList:e.tag_list||[],shareCount:l[e.id]||0,deadlineDisplay:a(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("작가별 Serials 가져오기 예외:",e),[]}}async function n(e){try{let{data:t,error:i}=await r.supabase.from("serials").select("*").eq("id",e).single();if(i)return console.error("Serial 가져오기 오류:",i),null;if(!t)return null;let o=await s(t.id);return{...t,tagList:t.tag_list||[],shareCount:o,deadlineDisplay:a(t.created_at,t.deadline,t.category)}}catch(e){return console.error("Serial 가져오기 예외:",e),null}}async function c(e){try{let{data:t,error:s}=await r.supabase.from("serials").select("*").eq("category",e).order("created_at",{ascending:!1});if(s)return console.error("카테고리별 serials 가져오기 오류:",s),[];if(!t||0===t.length)return[];let o=t.map(e=>e.id).filter(e=>null!=e),l=await i(o);return t.filter(e=>null!=e&&null!=e.id).map(e=>({...e,tagList:e.tag_list||[],shareCount:l[e.id]||0,deadlineDisplay:a(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("카테고리별 serials 가져오기 예외:",e),[]}}async function u(){return c("popular")}async function d(){try{let e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,{data:s,error:o}=await r.supabase.from("serials").select("*").order("created_at",{ascending:!1});if(o)return console.error("오늘 마감 serials 가져오기 오류:",o),[];if(!s||0===s.length)return[];let l=s.filter(e=>{if(!e||!e.id||!e.created_at||null===e.deadline||void 0===e.deadline)return!1;let r=new Date(e.created_at),a=r.getFullYear(),s=r.getMonth(),i=r.getDate(),o=new Date(a,s,i);o.setDate(o.getDate()+e.deadline);let l=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0");return`${l}-${n}-${c}`===t}),n=l.map(e=>e.id).filter(e=>null!=e),c=await i(n);return l.filter(e=>null!=e&&null!=e.id).map(e=>({...e,tagList:e.tag_list||[],shareCount:c[e.id]||0,deadlineDisplay:a(e.created_at,e.deadline,e.category)}))}catch(e){return console.error("오늘 마감 serials 가져오기 예외:",e),[]}}async function f(){return c("paid")}async function g(){return c("serial")}function h(e){return null==e?null:"number"==typeof e?e:parseInt(String(e),10)||null}async function p(){try{let e=await u();if(0===e.length)return{moved:0,errors:[]};let t=0,a=[];for(let s of e){let e=s.requirement;if(null!=e&&s.shareCount>=e){let{error:e}=await r.supabase.from("serials").update({category:"serial"}).eq("id",s.id);e?(console.error(`게시글 ${s.id} 이동 실패:`,e),a.push({postId:s.id,error:e})):t++}}return{moved:t,errors:a}}catch(e){return console.error("연재도전 → 연재시작코너 이동 예외:",e),{moved:0,errors:[{error:e}]}}}async function m(){try{let a=await t(),i=a.minimum_serial_share_count_for_paid,o=a.minimum_serial_episode_count,l=i&&parseInt(i,10)||1,n=o&&parseInt(o,10)||2;console.log(`설정값: 최소 공유 ${l}회, 최소 게시글 ${n}개`);let c=await g();if(0===c.length)return console.log("연재시작코너 게시글이 없습니다."),{moved:0,errors:[]};console.log(`연재시작코너 게시글 ${c.length}개 확인 중...`);let u=0,d=[];for(let t of c){let a=await s(t.id),{getPostsBySerialId:i}=await e.A(87697),o=await i(t.id),c=o?o.length:0;if(console.log(`Serial ${t.id}: 공유 ${a}회, 게시글 ${c}개`),a<l){console.log(`Serial ${t.id}: 공유 조건 미달 (${a} < ${l})`);continue}if(c<n){console.log(`Serial ${t.id}: 게시글 조건 미달 (${c} < ${n})`);continue}console.log(`Serial ${t.id}: 조건 충족! 유료연재코너로 이동 중... (공유: ${a}회, 게시글: ${c}개)`);let{error:f}=await r.supabase.from("serials").update({category:"paid"}).eq("id",t.id);f?(console.error(`게시글 ${t.id} 유료연재코너 이동 실패:`,f),d.push({postId:t.id,error:f})):(u++,console.log(`✓ 게시글 ${t.id}가 유료연재코너로 이동되었습니다. (공유: ${a}회, 게시글: ${c}개)`))}return console.log(`총 ${u}개 게시글이 유료연재코너로 이동되었습니다.`),{moved:u,errors:d}}catch(e){return console.error("연재시작코너 → 유료연재코너 이동 예외:",e),{moved:0,errors:[{error:e}]}}}async function y(e){try{if(!e||!e.trim())return[];let t=e.toLowerCase().trim(),s=t.startsWith("#"),o=s?t.substring(1):t,l=r.supabase.from("serials").select("*");if(s){let{data:e,error:r}=await l.order("created_at",{ascending:!1});if(r)return console.error("Serials 검색 오류:",r),[];let t=e?.filter(e=>(e.tag_list||[]).some(e=>e.toLowerCase().replace("#","")===o||e.toLowerCase().includes(o)))||[],s=t.map(e=>e.id),n=await i(s);return t.map(e=>({...e,tagList:e.tag_list||[],shareCount:n[e.id]||0,deadlineDisplay:a(e.created_at,e.deadline,e.category)}))}{l=l.or(`title.ilike.%${t}%,tags.ilike.%${t}%,intro.ilike.%${t}%`);let{data:e,error:r}=await l.order("created_at",{ascending:!1});if(r)return console.error("Serials 검색 오류:",r),[];let s=(e||[]).map(e=>e.id),o=await i(s);return(e||[]).map(e=>({...e,tagList:e.tag_list||[],shareCount:o[e.id]||0,deadlineDisplay:a(e.created_at,e.deadline,e.category)}))}}catch(e){return console.error("Serials 검색 예외:",e),[]}}async function _(e){try{let{data:{session:t}}=await r.supabase.auth.getSession(),{data:a,error:s}=await r.supabase.from("serials").insert([{title:e.title,deadline:e.deadline,apply:e.apply||"신청",tags:e.tags,category:e.category,intro:e.intro,requirement:e.requirement,tag_list:e.tagList||[],author_id:t?.user?.id||null}]).select().single();if(s)throw console.error("Serial 생성 오류:",s),s;return a}catch(e){throw console.error("Serial 생성 예외:",e),e}}async function S(){try{let{data:e,error:t}=await r.supabase.from("serials").select("id");if(t)return console.error("Serial IDs 가져오기 오류:",t),[];return(e||[]).map(e=>e.id)}catch(e){return console.error("Serial IDs 가져오기 예외:",e),[]}}async function w(e,t){try{let{data:a,error:s}=await r.supabase.from("shares").insert({serial_id:e,user_id:t}).select().single();if(s)return console.error("Share 추가 오류:",s),{success:!1,error:s};return{success:!0,data:a}}catch(e){return console.error("Share 추가 예외:",e),{success:!1,error:e}}}async function b(e,t){try{let{error:a}=await r.supabase.from("shares").delete().eq("serial_id",e).eq("user_id",t);if(a)return console.error("Share 제거 오류:",a),{success:!1,error:a};return{success:!0}}catch(e){return console.error("Share 제거 예외:",e),{success:!1,error:e}}}async function $(e,t){try{let{data:a,error:s}=await r.supabase.from("shares").select("id").eq("serial_id",e).eq("user_id",t).limit(1).maybeSingle();if(s)return console.error("Share 확인 오류:",s),!1;return!!a}catch(e){return console.error("Share 확인 예외:",e),!1}}async function v(e){try{let{data:t,error:s}=await r.supabase.from("shares").select(`
        serial_id,
        created_at,
        serials (*)
      `).eq("user_id",e).order("created_at",{ascending:!1});if(s)return console.error("공유한 연재 가져오기 오류:",s),[];let o=(t||[]).map(e=>e.serial_id),l=await i(o);return(t||[]).filter(e=>e.serials).map(e=>({...e.serials,tagList:e.serials.tag_list||[],shareCount:l[e.serial_id]||0,sharedAt:e.created_at,deadlineDisplay:a(e.serials.created_at,e.serials.deadline,e.serials.category)}))}catch(e){return console.error("공유한 serials 가져오기 예외:",e),[]}}async function D(e,t){try{let{data:a,error:s}=await r.supabase.from("favorites").insert({serial_id:e,user_id:t}).select().single();if(s){if("PGRST205"===s.code||"42P01"===s.code||s.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),{success:!1,error:{message:"favorites 테이블이 아직 생성되지 않았습니다."}};return console.error("관심있는 글 추가 오류:",s),{success:!1,error:s}}return{success:!0,data:a}}catch(e){return console.error("관심있는 글 추가 예외:",e),{success:!1,error:e}}}async function q(e,t){try{let{error:a}=await r.supabase.from("favorites").delete().eq("serial_id",e).eq("user_id",t);if(a){if("PGRST205"===a.code||"42P01"===a.code||a.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),{success:!1,error:{message:"favorites 테이블이 아직 생성되지 않았습니다."}};return console.error("관심있는 글 제거 오류:",a),{success:!1,error:a}}return{success:!0}}catch(e){return console.error("관심있는 글 제거 예외:",e),{success:!1,error:e}}}async function C(e){try{let{data:t,error:s}=await r.supabase.from("favorites").select(`
        serial_id,
        created_at,
        serials (*)
      `).eq("user_id",e).order("created_at",{ascending:!1});if(s){if("PGRST205"===s.code||"42P01"===s.code||s.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),[];return console.error("관심있는 연재 가져오기 오류:",s),[]}let o=(t||[]).map(e=>e.serial_id),l=await i(o);return(t||[]).filter(e=>e.serials).map(e=>({...e.serials,tagList:e.serials.tag_list||[],shareCount:l[e.serial_id]||0,favoritedAt:e.created_at,deadlineDisplay:a(e.serials.created_at,e.serials.deadline,e.serials.category)}))}catch(e){return console.error("관심있는 글 가져오기 예외:",e),[]}}async function T(e,t){try{let{data:a,error:s}=await r.supabase.from("favorites").select("id").eq("serial_id",e).eq("user_id",t).limit(1).maybeSingle();if(s){if("PGRST205"===s.code||"42P01"===s.code||s.message?.includes("Could not find the table"))return console.warn("favorites 테이블이 아직 생성되지 않았습니다. migration을 실행해주세요."),!1;return console.error("관심있는 글 확인 오류:",s),!1}return!!a}catch(e){return console.error("관심있는 글 확인 예외:",e),!1}}async function P(e,t){try{let{data:t,error:a}=await r.supabase.from("serials").select("id, category").eq("id",e).single();if(a||!t)return console.error("Serial 찾기 오류:",a),{success:!1,error:a||Error("Serial을 찾을 수 없습니다.")};let{data:s,error:i}=await r.supabase.from("serials").update({category:"popular"}).eq("id",e).select().single();if(i)return console.error("연재도전 연재 오류:",i),{success:!1,error:i};return{success:!0,data:s}}catch(e){return console.error("연재도전 연재 예외:",e),{success:!1,error:e}}}async function L(t,a){try{if(!t)return{success:!1,error:Error("잘못된 요청입니다.")};let{isAdminEmail:s}=await e.A(87697);if(!s(a))return{success:!1,error:Error("관리자만 연재를 삭제할 수 있습니다.")};let{getPostsBySerialId:i}=await e.A(87697),o=await i(t);if(o&&o.length>0){let{error:e}=await r.supabase.from("posts").delete().eq("serial_id",t);e&&console.error("연재 글 삭제 오류:",e)}let{error:l}=await r.supabase.from("serials").delete().eq("id",t);if(l)return console.error("연재 삭제 오류:",l),{success:!1,error:l};return{success:!0}}catch(e){return console.error("연재 삭제 예외:",e),{success:!1,error:e}}}e.s(["addFavorite",()=>D,"addShare",()=>w,"createSerial",()=>_,"deleteSerial",()=>L,"formatDeadline",()=>a,"getAllSerialIds",()=>S,"getAllSerials",()=>o,"getPaidSeriesSerials",()=>f,"getPopularSerials",()=>u,"getSerialById",()=>n,"getSerialPosts",()=>g,"getSerialsByAuthor",()=>l,"getSerialsByCategory",()=>c,"getShareCount",()=>s,"getTodayDeadlineSerials",()=>d,"getUserFavorites",()=>C,"getUserSharedSerials",()=>v,"hasUserFavorited",()=>T,"hasUserShared",()=>$,"movePopularToSerial",()=>p,"moveSerialToPaid",()=>m,"parseRequirement",()=>h,"publishSerialToPopular",()=>P,"removeFavorite",()=>q,"removeShare",()=>b,"searchSerials",()=>y],44518)},87697,e=>{e.v(e=>Promise.resolve().then(()=>e(52750)))}]);